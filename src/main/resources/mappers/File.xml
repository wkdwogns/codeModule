<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="com.nexon.common.file.dao.FileDao">

    <insert id="insertFileGrp" parameterType="map" useGeneratedKeys="true" keyProperty="fileGrpSeq">
        INSERT INTO
        TB_FILE_GRP(GRP_NM, CATEGORY, DEL_YN, CRE_ID, CRE_DT, UPD_ID, UPD_DT)
        VALUES( #{grpNm}, #{category}, 'N', #{creId}, UTC_TIMESTAMP(), #{updId}, UTC_TIMESTAMP())
    </insert>

    <insert id="insertFile" parameterType="map" useGeneratedKeys="true" keyProperty="fileSeq">
        INSERT INTO
        TB_FILE(FILE_GRP_SEQ, ORG_FILE_NM, SYS_FILE_NM, ORDER_NO, FILE_PATH, TYPE, SUB_TYPE,  DEL_YN, CRE_ID, CRE_DT, UPD_ID, UPD_DT)
        VALUES( #{fileGrpSeq}, #{orgFileNm}, #{sysFileNm}, #{orderNo}, #{filePath}, #{type}, #{subType}, 'N', #{creId}, UTC_TIMESTAMP(), #{updId}, UTC_TIMESTAMP())
    </insert>

    <update id="updateFile" parameterType="map">
        UPDATE TB_FILE
        SET UPD_DT = UTC_TIMESTAMP()
        <if test="fileGrpSeq != null">
            , FILE_GRP_SEQ = #{fileGrpSeq}
        </if>
        <if test="orgFileNm != null">
            , ORG_FILE_NM = #{orgFileNm}
        </if>
        <if test="SysFileNm != null">
            , SYS_FILE_NM = #{SysFileNm}
        </if>
        <if test="filePath != null">
            , FILE_PATH = #{filePath}
        </if>
        <if test="type != null">
            , TYPE = #{type}
        </if>
        <if test="subType != null">
            , SUB_TYPE = #{subType}
        </if>
        <if test="orderNo != null">
            , ORDER_NO = #{orderNo}
        </if>
        <if test="delYn != null">
            , DEL_YN = #{delYn}
        </if>
        <if test="updId != null">
            , UPD_ID = #{updId}
        </if>
        where FILE_SEQ = #{fileSeq}
    </update>

    <select id="selectFile" resultType="com.nexon.common.file.dto.model.FileInfo" parameterType="map">
        SELECT FILE_SEQ
        ,FILE_GRP_SEQ
        ,ORG_FILE_NM
        ,SYS_FILE_NM
        ,ORDER_NO
        ,FILE_PATH
        ,TYPE
        ,SUB_TYPE
        ,DEL_YN
        ,CRE_ID
        ,CRE_DT
        ,UPD_ID
        ,UPD_DT
        FROM TB_FILE
        WHERE IFNULL(DEL_YN, 'N') = 'N'
        <if test="fileSeq != null">
            AND FILE_SEQ = #{fileSeq}
        </if>
        <if test="fileGrpSeq != null">
            AND FILE_GRP_SEQ = #{fileGrpSeq}
        </if>
        ORDER BY FILE_SEQ DESC
    </select>


    <update id="updateFileGrp" parameterType="map">
        UPDATE TB_FILE_GRP
        SET UPD_DT = UTC_TIMESTAMP()
        <if test="grpNm != null">
            , GRP_NM = #{grpNm}
        </if>
        <if test="category != null">
            , CATEGORY = #{category}
        </if>
        <if test="delYn != null">
            , DEL_YN = #{delYn}
        </if>
        <if test="updId != null">
            , UPD_ID = #{updId}
        </if>
        where FILE_GRP_SEQ = #{fileGrpSeq}
    </update>

</mapper> 
