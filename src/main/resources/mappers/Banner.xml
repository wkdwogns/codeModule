<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nexon.banner.dao.BannerDao">
    <select id="selectBanner" parameterType="com.nexon.banner.req.BannerTypeReq" resultType="com.nexon.banner.model.BannerListVO">
        SELECT b.BANNER_SEQ
              , b.BANNER_NM
              , b.CATEGORY
              , b.BANNER_TYPE
              , b.VIEW_ST_DT
              , b.VIEW_END_DT
              , b.VIEW_UNLIMIT_YN
              , b.TARGET_URL
              , b.VIDEO_URL
              , b.THUMBNAIL_NM
              , b.TOP_TEXT
              , b.TITLE
              , b.CONTENTS
              , (SELECT F.FILE_PATH from TB_FILE F WHERE F.FILE_GRP_SEQ = b.FILE_GRP_SEQ AND F.DEL_YN = 'N') FILE_PATH
        FROM TB_BANNER b
         WHERE b.DEL_YN = 'N'
           AND b.CATEGORY = #{category}
           AND b.VIEW_YN = 'Y'
           AND (b.VIEW_UNLIMIT_YN = 'Y'
               OR DATE_FORMAT(now(), '%Y.%m.%d %H:%i') BETWEEN DATE_FORMAT(b.VIEW_ST_DT, '%Y.%m.%d %H:%i') AND DATE_FORMAT(b.VIEW_END_DT, '%Y.%m.%d %H:%i'))
        ORDER BY IFNULL(b.SORT_NO, 99)
    </select>

    <select id="selectPopup" resultType="com.nexon.banner.model.PopupBannerListVO">
          SELECT POPUP_SEQ
              , POPUP_NM
              , VIEW_YN
              , VIEW_ST_DT
              , VIEW_END_DT
              , TARGET_URL
              , TARGET_YN
              , FILE_GRP_SEQ
              , CRE_DT
          FROM TB_POPUP
         WHERE DEL_YN = 'N'
          AND VIEW_YN = 'Y'
          AND (VIEW_UNLIMIT_YN = 'Y'
           OR DATE_FORMAT(now(), '%Y.%m.%d %H:%i') BETWEEN DATE_FORMAT(VIEW_ST_DT, '%Y.%m.%d %H:%i') AND DATE_FORMAT(VIEW_END_DT, '%Y.%m.%d %H:%i'))
       ORDER BY CRE_DT DESC
    </select>

</mapper>
